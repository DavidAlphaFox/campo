<div id="topic" class="topic card mt-4" data-controller="topic" data-topic-id="<%= @topic.id %>" data-creator-id="<%= @topic.user.id %>">
  <div class="card-header border-bottom">
    <div class="toolbar">
      <div class="toolbar-title">
        <a href="<%= forum_path(@topic.forum) %>" class="text-secondary"><%= @topic.forum.name %></a>
        <%= @topic.title %>
      </div>
      <div class="toolbar-action">
        <button type="button" class="button button-icon">
          <i class="material-icons">more_vert</i>
        </button>
      </div>
    </div>
  </div>

  <div class="topic-content">
    <div class="topic-main">
      <div class="p-2 text-secondary text-align-center d-none" data-target="topic.loadingBefore">
        <i class="material-icons animated spin">sync</i>
      </div>
      <div id="posts"
        class="list"
        data-target="topic.posts"
        data-focus-id="<%= @focus_post&.id %>"
        data-begin-id="<%= @posts.first&.id %>"
        data-end-id="<%= @posts.last&.id %>"
        data-reached-begin="<%= @reached_begin %>"
        data-reached-end="<%= @reached_end %>"
        data-offset="<%= @offset %>"
        data-total="<%= @topic.posts.count %>"
        >
        <%= render partial: 'posts/post', collection: @posts, cached: -> post { [I18n.locale, post, post.user] } %>
      </div>
      <div class="p-2 text-secondary text-align-center d-none" data-target="topic.loadingAfter">
        <i class="material-icons animated spin">sync</i>
      </div>
    </div>

    <div class="topic-sidebar">
      <div class="topic-panel">
        <% if Current.user %>
          <button type="button" class="button button-text button-primary" data-action="topic#newPost">
            <i class="material-icons">reply</i> Reply
          </button>
        <% else %>
          <a href="<%= new_session_path %>" class="btn btn-primary">Sign in</a>
        <% end %>
        <div class="slider" data-controller="slider" data-slider-begin="<%= @offset + 1 %>" data-slider-end="<%= @offset + 1 %>" data-slider-total="<%= @topic.posts.count %>" data-target="topic.slider">
          <button type="button" class="button button-text" data-action="slider#min">
            <i class="material-icons">expand_less</i> First post
          </button>
          <div class="slider-scrollbar" data-target="slider.scrollbar">
            <div class="slider-handle" data-target="slider.handle">
              <div class="slider-bar">
              </div>
              <div class="slider-info">
                <span data-target="slider.value"></span> / <span data-target="slider.range"></span>
              </div>
            </div>
          </div>
          <button type="button" class="button button-text" data-action="slider#max">
            <i class="material-icons">expand_more</i> Last post
          </button>
        </div>
      </div>
    </div>
  </div>



  <% if Current.user %>
    <div id="post-composer" class="composer post-composer" data-controller="composer" data-target="topic.composer">
      <div class="container">
        <div class="row h-100">
          <div class="col-md-9 post-composer-col">
            <div class="composer-content">
            </div>
          </div>
        </div>
      </div>
    </div>

    <template data-target="topic.newPostFormTemplate">
      <%= render 'posts/form', post: @topic.posts.new %>
    </template>
  <% end %>
</div>
